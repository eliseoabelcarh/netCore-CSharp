@model List<PanelNewTienda.Models.CarritoItem>

@{
    ViewData["Title"] = "CarritoDeCompras";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>CarritoDeCompras</h1>


@if (Model.Count() <= 0)
{

    <div>No hay Productos en tu Carrito</div>

}
else
{

<form method="post">

    <a class="btn btn-secondary" asp-controller="Home" asp-action="GetProductosAPI" >Seguir comprando</a>
    <input type="submit" value="Guardar Cambios" class="btn btn-primary" asp-action="ActualizarCarritoDeCompras" asp-controller="Home" />
    <input type="submit" value="Checkout >>>" class="btn btn-primary" asp-controller="Home" asp-action="Checkout" />



    @foreach (var nroTienda in @ViewBag.listaNrosTiendas)
    {
        double totalTienda = 0;


        <table class="table table-striped table-responsive table-body">

            <thead>
                <tr>
                    <th scope="col"> Vendedor</th>
                    <th scope="col">  @Html.DisplayNameFor(model => Model[0].Producto)</th>
                    <th scope="col">@Html.DisplayNameFor(model => Model[0].Cantidad)</th>
                    <th scope="col"> @Html.DisplayNameFor(model => Model[0].PrecioCarritoItem)</th>
                    <th></th>
                </tr>
            </thead>


            @for (var i = 0; i < Model.Count(); i++)
            {





                @if (@Model[i].IdTienda == nroTienda)
                {






                    <tbody>




                        <tr>

                            <th scope="row">

                                <input type="hidden" asp-for="@Model[i].IdTienda" />
                                Tienda @Html.DisplayFor(modelItem => @Model[i].IdTienda)

                            </th>

                            <td>

                                <input type="hidden" asp-for="@Model[i].Producto.Imagen1" />
                                <div class="d-flex flex-row">

                                    @{
                                        if (@Model[i].Producto.Imagen1 != null)
                                        {
                                            string imageBase64Data = Convert.ToBase64String(@Model[i].Producto.Imagen1);
                                            string imageDataURL = string.Format("data:image/jpg;base64,{0}", imageBase64Data);


                                            <div class="p-2 mr-2" style="background-image:url(@imageDataURL); background-repeat:no-repeat; background-position: center center;background-size:cover; width:2.9rem;height:3rem;"></div>
                                        }
                                        else
                                        {
                                            <img class="p-2" src="~/imagenes/imagenDemo.svg" alt="" style="width:3rem;height:3rem;">

                                        }

                                    }

                                    <input type="hidden" asp-for="@Model[i].Producto.IdProducto" />
                                    @Html.DisplayFor(modelItem => @Model[i].Producto.NombreProducto)
                                </div>


                            </td>

                            <td>

                                <input asp-for="@Model[i].Cantidad" type="number" class="botonesCantidad" data-decimals="0" min="1" max="20" />

                            </td>

                            <td>

                                @Html.DisplayFor(modelItem => @Model[i].PrecioCarritoItem)
                                @{totalTienda += @Model[i].PrecioCarritoItem;}
                            </td>

                            <td>
                                <a class="btn btn-primary" asp-controller="Home" asp-action="EliminarProductoDeMiCarrito" asp-route-id="@Model[i].Producto.IdProducto">Eliminar</a>
                            </td>

                        </tr>




                    </tbody>




                }




            }


            <tfoot>
                <tr>
                    <td></td>
                    <td></td>
                    <th scope="row">Total:</th>
                    <th scope="row">@totalTienda</th>
                    <th></th>
                </tr>
            </tfoot>

        </table>


        <br />

    }


</form>



}





